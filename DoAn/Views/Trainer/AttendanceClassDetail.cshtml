@model DoAn.Models.AttendanceViewModel

<h2>Điểm danh lớp: @Model.GymClass.Name</h2>
<h4>Buổi: @Model.SelectedSessionDate.ToString("dd/MM/yyyy") (@Model.SelectedSessionDate.ToString("dddd", new System.Globalization.CultureInfo("vi-VN")))</h4>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}
@if (TempData["Warning"] != null)
{
    <div class="alert alert-warning">@TempData["Warning"]</div>
}

@using (Html.BeginForm("SaveAttendanceList", "Trainer", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    @Html.Hidden("classId", Model.GymClass.ClassId)
    @Html.Hidden("sessionDate", Model.SelectedSessionDate) 

    <table class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>Học viên</th>
                <th>Họ và tên</th>
                <th>Email</th>
                <th>Điện thoại</th>
                <th>Trạng thái điểm danh</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var b in Model.Bookings)
            {
                var at = b.Attendance
                          .FirstOrDefault(a => a.AttendanceTime.Date == Model.SelectedSessionDate.Date);

                <tr>
                    <td>@b.Users.Username</td>
                    @{
                        var fullName = b.Users.MemberProfile != null ? b.Users.MemberProfile.FullName : b.Users.Username;
                    }
                    <td>@fullName</td>
                    <td>@b.Users.Email</td>
                    <td>@b.Users.PhoneNumber</td>
                    <td>
                        <select name="attendanceStatus[@b.BookingId]" class="form-select form-select-sm">
                            <option value="Present" @(at?.Status == "Present" ? "selected" : "")>Có mặt</option>
                            <option value="Late" @(at?.Status == "Late" ? "selected" : "")>Trễ</option>
                            <option value="Absent" @(at?.Status == "Absent" ? "selected" : "")>Vắng</option>
                        </select>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <button type="submit" class="btn btn-primary mt-2">Lưu tất cả</button>
}
