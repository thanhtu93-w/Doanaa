@{
    ViewBag.Title = "Lịch học của tôi";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var groupSchedule = ViewBag.GroupSchedule as List<DoAn.Controllers.MemberController.ClassVM> ?? new List<DoAn.Controllers.MemberController.ClassVM>();
    var ptSchedule = ViewBag.PTSchedule as List<DoAn.Controllers.MemberController.ScheduleItemVM> ?? new List<DoAn.Controllers.MemberController.ScheduleItemVM>();

    Func<string, string> GetWeekDays = days =>
    {
        if (string.IsNullOrEmpty(days)) return "";
        var dayNames = new Dictionary<string, string>
        {
            {"2","Thứ 2"}, {"3","Thứ 3"}, {"4","Thứ 4"}, {"5","Thứ 5"},
            {"6","Thứ 6"}, {"7","Thứ 7"}, {"1","Chủ nhật"}, {"8","Chủ nhật"}
                };
        return string.Join(", ", days.Split(',').Select(d => dayNames.ContainsKey(d) ? dayNames[d] : d));
    };
}

<h2>Lịch Group Class</h2>
@if (groupSchedule.Any())
{
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Lớp</th>
                <th>Trainer</th>
                <th>Thứ</th>
                <th>Thời gian</th>
                <th>Trạng thái</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in groupSchedule)
            {
                <tr>
                    <td>@item.Name</td>
                    <td>@item.TrainerName</td>
                    <td>@GetWeekDays(item.RecurrenceDays)</td>
                    <td>@(item.TimeFrom?.ToString(@"hh\:mm") ?? "-") - @(item.TimeTo?.ToString(@"hh\:mm") ?? "-")</td>
                    <td>
                        @switch (item.Status)
                        {
                            case "Pending":<span class="badge bg-warning text-dark">Chờ xác nhận</span>; break;
                            case "Confirmed": <span class="badge bg-success">Đã xác nhận</span>; break;
                            case "Cancelled": <span class="badge bg-danger">Đã hủy</span>; break;
                            default: <span class="badge bg-secondary">@item.Status</span>; break;
                    }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p class="text-muted">Chưa có lịch lớp nhóm.</p>
}

<h2>Lịch PT 1-1</h2>
@if (ptSchedule.Any())
{
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Trainer</th>
                <th>Thời gian</th>
                <th>Trạng thái</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in ptSchedule)
            {
                <tr>
                    <td>@item.Trainer</td>
                    <td>@(item.TimeFrom?.ToString(@"hh\:mm") ?? "-") - @(item.TimeTo?.ToString(@"hh\:mm") ?? "-")</td>
                    <td>
                        @switch (item.Status)
                        {
                            case "Pending":<span class="badge bg-warning text-dark">Chờ xác nhận</span>; break;
                            case "Confirmed": <span class="badge bg-success">Đã xác nhận</span>; break;
                            case "Cancelled": <span class="badge bg-danger">Đã hủy</span>; break;
                            default: <span class="badge bg-secondary">@item.Status</span>; break;
                    }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p class="text-muted">Chưa có lịch PT 1-1.</p>
}
